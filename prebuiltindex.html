<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TSPOS Starter</title>
  <style>
    body {
      background: #1e1e1e;
      color: #ccc;
      font-family: monospace;
      margin: 0;
      padding: 0;
    }

    #terminal-wrapper {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    #terminal {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }

    #input-line {
      display: flex;
      background: #111;
      border-top: 1px solid #333;
      padding: 10px;
    }

    #prompt {
      margin-right: 8px;
      color: #0f0;
    }

    #command-input {
      flex: 1;
      background: #000;
      color: #fff;
      border: none;
      font-family: monospace;
      font-size: 14px;
      outline: none;
    }

    .output {
      margin-bottom: 4px;
    }

    .output.success { color: #6f6; }
    .output.error { color: #f66; }
    .output.info { color: #6cf; }
    .output.warn { color: #fc0; }
  </style>
</head>
<body>
  <div id="terminal-wrapper">
    <div id="terminal">
      <div class="output">Welcome to TSPOS Starter! Type 'help' to begin.</div>
    </div>
    <div id="input-line">
      <span id="prompt">$</span>
      <input type="text" id="command-input" autofocus />
    </div>
  </div>

  <script>
    const terminal = document.getElementById("terminal");
    const input = document.getElementById("command-input");

    // Global working directory and commands
    window.cwd = "/";
    window.commands = {};
    window.commandHistory = [];

    // === PRINT FUNCTION (NOW GLOBAL) ===
    function print(text, type = "default") {
      const output = document.createElement("div");
      output.className = `output ${type}`;
      output.textContent = text;
      terminal.appendChild(output);
      terminal.scrollTop = terminal.scrollHeight;
    }

    // âœ… Make print available to all packages
    window.print = print;

    // === BASIC COMMANDS ===
    commands.help = {
      desc: "Show available commands",
      fn(args, print) {
        const list = Object.entries(commands)
          .map(([name, cmd]) => `  ${name.padEnd(12)} - ${cmd.desc || "No description"}`)
          .join("\n");
        print("Available commands:\n" + list);
      }
    };

    commands.echo = {
      desc: "Print to screen",
      fn(args, print) {
        print(args.join(" "));
      }
    };

    commands.clear = {
      desc: "Clear terminal screen",
      fn(args, print) {
        terminal.innerHTML = "";
      }
    };

    commands.pwd = {
      desc: "Show current directory",
      fn(args, print) {
        print(window.cwd);
      }
    };

    commands.cd = {
      desc: "Change directory",
      fn(args, print) {
        print("Directory change not implemented.");
      }
    };

    commands.ls = {
      desc: "List directory",
      fn(args, print) {
        print("Directory listing not implemented.");
      }
    };

    // === PACKAGE MANAGER ===
    commands.pkg = {
      desc: "TSPOS package manager",
      fn: async (args, print) => {
        const subcmd = args[0];
        const pkgName = args[1];

        if (subcmd === "install" && pkgName) {
          const rawName = pkgName.endsWith(".js") ? pkgName : `${pkgName}.js`;
          const url = `https://raw.githubusercontent.com/jhlbrothers2-stack/TSPOS/main/${rawName}`;
          try {
            await import(url);
            print(`Installed ${rawName}`, "success");
          } catch (err) {
            print(`Failed to install ${rawName}`, "error");
          }
        } else if (subcmd === "help") {
          print("Usage: pkg install <package.js>");
        } else {
          print("Usage: pkg install <package.js>");
        }
      }
    };

    // === RUN COMMAND ===
    async function runCommandLine(line) {
      const inputLine = line.trim();
      if (!inputLine) return;

      const args = inputLine.split(" ");
      const cmd = args.shift();
      const command = commands[cmd];

      print(`$ ${inputLine}`, "info");
      window.commandHistory.push(inputLine);

      if (!command) {
        print(`Command not found: ${cmd}`, "error");
        return;
      }

      try {
        await command.fn(args, print);
      } catch (err) {
        print(`Error: ${err.message}`, "error");
      }
    }

    // === INPUT HANDLING ===
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        const line = input.value;
        input.value = "";
        runCommandLine(line);
      }
    });
  </script>
</body>
</html>
