<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSPOS Terminal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background: #1a1a1a;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: #0d0d0d;
            padding: 8px 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #00ffcc;
        }

        .logo-icon {
            width: 18px;
            height: 18px;
            background: #00ffcc;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 11px;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .control-btn {
            background: #333;
            border: none;
            color: #ccc;
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }

        .control-btn:hover {
            background: #444;
        }

        .terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #000;
            margin: 10px;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        #terminal {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.3;
        }

        .terminal-line {
            margin-bottom: 4px;
            white-space: pre-wrap;
        }

        .cmd-input {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #0a0a0a;
            border-top: 1px solid #222;
        }

        #prompt {
            color: #00ffcc;
            margin-right: 8px;
            user-select: none;
        }

        #cmdline {
            flex: 1;
            background: transparent;
            border: none;
            color: #e0e0e0;
            font-size: 13px;
            outline: none;
        }

        .footer {
            padding: 6px 12px;
            background: #0d0d0d;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #666;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .online {
            background: #00ffcc;
        }

        .drag-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 30, 30, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            border: 2px dashed #00ffcc;
        }

        .drag-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .drag-text {
            color: #00ffcc;
            font-size: 18px;
            font-weight: bold;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        /* Command output colors */
        .cmd { color: #00ffcc; }
        .file { color: #bb86fc; }
        .dir { color: #82b1ff; }
        .error { color: #ff5252; }
        .success { color: #69f0ae; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <div class="logo-icon">T</div>
            <span>TSPOS Terminal</span>
        </div>
        <div class="window-controls">
            <button class="control-btn" id="clearBtn">Clear</button>
        </div>
    </div>

    <div class="terminal-container">
        <div id="terminal"></div>
        <div class="cmd-input">
            <span id="prompt">user@tspos:~$</span>
            <input type="text" id="cmdline" autofocus autocomplete="off" spellcheck="false">
        </div>
    </div>

    <div class="footer">
        <div class="status-item">
            <div class="status-dot online"></div>
            <span>Online</span>
        </div>
        <div class="status-item">
            <span>Drag .js files to install packages</span>
        </div>
    </div>

    <div class="drag-overlay" id="dragOverlay">
        <div class="drag-text">Drop .js files here to load packages</div>
    </div>

    <script>
        // Core terminal functionality
        document.addEventListener('DOMContentLoaded', () => {
            const terminal = document.getElementById('terminal');
            const input = document.getElementById('cmdline');
            const dragOverlay = document.getElementById('dragOverlay');
            let commandHistory = [];
            let historyIndex = -1;
            let currentInput = '';

            // Initialize with welcome message
            printWelcome();

            // Focus on input
            input.focus();

            // Command history navigation
            input.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    navigateHistory('up');
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    navigateHistory('down');
                }
            });

            // Command execution
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const command = input.value.trim();
                    if (command) {
                        executeCommand(command);
                        commandHistory.push(command);
                        historyIndex = commandHistory.length;
                        input.value = '';
                    }
                }
            });

            // Clear button functionality
            document.getElementById('clearBtn').addEventListener('click', () => {
                terminal.innerHTML = '';
                printWelcome();
            });

            // Drag and drop functionality
            document.addEventListener('dragover', (e) => {
                e.preventDefault();
                dragOverlay.classList.add('active');
            });

            document.addEventListener('dragleave', (e) => {
                e.preventDefault();
                if (e.clientX < 5 || e.clientY < 5 || 
                    e.clientX > window.innerWidth - 5 || 
                    e.clientY > window.innerHeight - 5) {
                    dragOverlay.classList.remove('active');
                }
            });

            document.addEventListener('drop', (e) => {
                e.preventDefault();
                dragOverlay.classList.remove('active');
                
                const files = e.dataTransfer.files;
                for (const file of files) {
                    if (!file.name.endsWith('.js')) {
                        print(`Skipped non-JS file: ${file.name}`, 'error');
                        continue;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = evt => {
                        try {
                            new Function(evt.target.result)();
                            print(`Loaded package: ${file.name}`, 'success');
                        } catch (err) {
                            print(`Error loading ${file.name}: ${err.message}`, 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            });

            // Print welcome message
            function printWelcome() {
                const welcomeMsg = `
<span class="success">Welcome to TSPOS Terminal</span>
<span>Type 'help' to see available commands</span>
<span>Drag and drop .js files to load packages</span>
<span>----------------------------------------</span>
                `;
                terminal.innerHTML += welcomeMsg;
            }

            // Execute commands
            function executeCommand(cmd) {
                const args = cmd.split(' ');
                const command = args[0].toLowerCase();
                
                print(`<span class="cmd">user@tspos:~$</span> ${cmd}`);
                
                // Check if command exists in global commands object
                if (window.commands && window.commands[command]) {
                    try {
                        window.commands[command].fn(args.slice(1), print, window.fs, executeCommand);
                    } catch (err) {
                        print(`Error executing command: ${err.message}`, 'error');
                    }
                } else {
                    print(`Command not found: ${command}. Type 'help' for available commands.`, 'error');
                }
                
                terminal.scrollTop = terminal.scrollHeight;
            }

            // Print to terminal
            function print(text, className = '') {
                const line = document.createElement('div');
                line.className = `terminal-line ${className}`;
                line.innerHTML = text;
                terminal.appendChild(line);
                terminal.scrollTop = terminal.scrollHeight;
            }

            // Navigate command history
            function navigateHistory(direction) {
                if (commandHistory.length === 0) return;
                
                if (direction === 'up') {
                    if (historyIndex > 0) {
                        historyIndex--;
                    }
                } else {
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                    } else {
                        historyIndex = commandHistory.length;
                        input.value = currentInput;
                        return;
                    }
                }
                
                if (historyIndex >= 0 && historyIndex < commandHistory.length) {
                    input.value = commandHistory[historyIndex];
                    currentInput = input.value;
                }
            }

            // Initialize file system
            window.fs = {
                storage: { "/": {} },
                normalize(p) {
                    p = p || "/";
                    if (!p.startsWith("/")) p = "/" + p;
                    return p.replace(/\/+$/, '') || "/";
                },
                split(p) {
                    p = this.normalize(p);
                    const parts = p.split("/");
                    const base = parts.pop();
                    const dir = parts.length === 1 ? "/" : parts.join("/");
                    return { dir, base };
                },
                getNode(p) {
                    p = this.normalize(p);
                    if (p === "/") return this.storage["/"];
                    const parts = p.split("/").filter(Boolean);
                    let current = this.storage["/"];
                    for (let part of parts) {
                        if (!(part in current)) return undefined;
                        current = current[part];
                    }
                    return current;
                },
                setNode(p, value) {
                    const { dir, base } = this.split(p);
                    const parent = this.getNode(dir);
                    if (typeof parent === "object") {
                        parent[base] = value;
                        return true;
                    }
                    return false;
                },
                rm(p) {
                    const { dir, base } = this.split(p);
                    const parent = this.getNode(dir);
                    if (parent && base in parent) {
                        delete parent[base];
                        return true;
                    }
                    return false;
                },
                mkdir(p) {
                    return this.setNode(p, {});
                },
                exists(p) {
                    return this.getNode(p) !== undefined;
                },
                ls(p = "/") {
                    const node = this.getNode(p);
                    return node && typeof node === "object" ? Object.keys(node) : [];
                }
            };
        });
    </script>
</body>
</html>